window.CozyAuth=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){e.exports=r(5)},function(e,t,r){"use strict";r.r(t),r.d(t,"nil",function(){return n});var n={};t.default=n},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,t){function r(e,t,r,n,a,i,s){try{var o=e[i](s),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,a)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise(function(a,i){var s=e.apply(t,n);function o(e){r(s,a,i,o,u,"next",e)}function u(e){r(s,a,i,o,u,"throw",e)}o(void 0)})}}},function(e,t,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),a=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=a&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(6),a)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,a=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=w;var h="suspendedStart",f="suspendedYield",p="executing",y="completed",v={},d={};d[s]=function(){return this};var m=Object.getPrototypeOf,b=m&&m(m(P([])));b&&b!==n&&a.call(b,s)&&(d=b);var g=S.prototype=k.prototype=Object.create(d);K.prototype=g.constructor=S,S.constructor=K,S[u]=K.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===K||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(g),e},l.awrap=function(e){return{__await:e}},B(A.prototype),A.prototype[o]=function(){return this},l.AsyncIterator=A,l.async=function(e,t,r,n){var a=new A(w(e,t,r,n));return l.isGeneratorFunction(t)?a:a.next().then(function(e){return e.done?e.value:a.next()})},B(g),g[u]="Generator",g[s]=function(){return this},g.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},l.values=P,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=r),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var u=a.call(s,"catchLoc"),c=a.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),_(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;_(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function w(e,t,r,n){var a=t&&t.prototype instanceof k?t:k,i=Object.create(a.prototype),s=new O(n||[]);return i._invoke=function(e,t,r){var n=h;return function(a,i){if(n===p)throw new Error("Generator is already running");if(n===y){if("throw"===a)throw i;return T()}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var o=E(s,r);if(o){if(o===v)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=x(e,t,r);if("normal"===u.type){if(n=r.done?y:f,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=y,r.method="throw",r.arg=u.arg)}}}(e,r,s),i}function x(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function k(){}function K(){}function S(){}function B(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function A(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,s){var o=x(e[r],e,n);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"==typeof c&&a.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,s)},function(e){t("throw",e,i,s)}):Promise.resolve(c).then(function(e){u.value=e,i(u)},function(e){return t("throw",e,i,s)})}s(o.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function E(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,E(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var a=x(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function P(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:T}}function T(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){"use strict";r.r(t);var n,a=r(0),i=r.n(a),s=r(4),o=r.n(s),u=r(2),c=r.n(u),l=r(3),h=r.n(l);!function(e){e[e.Android=0]="Android",e[e.iOS=1]="iOS",e[e.ChromeExtension=2]="ChromeExtension",e[e.FirefoxExtension=3]="FirefoxExtension",e[e.OperaExtension=4]="OperaExtension",e[e.EdgeExtension=5]="EdgeExtension",e[e.WindowsDesktop=6]="WindowsDesktop",e[e.MacOsDesktop=7]="MacOsDesktop",e[e.LinuxDesktop=8]="LinuxDesktop",e[e.ChromeBrowser=9]="ChromeBrowser",e[e.FirefoxBrowser=10]="FirefoxBrowser",e[e.OperaBrowser=11]="OperaBrowser",e[e.EdgeBrowser=12]="EdgeBrowser",e[e.IEBrowser=13]="IEBrowser",e[e.UnknownBrowser=14]="UnknownBrowser",e[e.AndroidAmazon=15]="AndroidAmazon",e[e.UWP=16]="UWP",e[e.SafariBrowser=17]="SafariBrowser",e[e.VivaldiBrowser=18]="VivaldiBrowser",e[e.VivaldiExtension=19]="VivaldiExtension",e[e.SafariExtension=20]="SafariExtension"}(n||(n={}));var f,p,y=function(){function e(){c()(this,e),this.identityClientId="web",this.browserCache=null}return h()(e,[{key:"getDevice",value:function(){return null!=this.browserCache?this.browserCache:(-1!==navigator.userAgent.indexOf(" Firefox/")||-1!==navigator.userAgent.indexOf(" Gecko/")?this.browserCache=n.FirefoxBrowser:navigator.userAgent.indexOf(" OPR/")>=0?this.browserCache=n.OperaBrowser:-1!==navigator.userAgent.indexOf(" Edge/")?this.browserCache=n.EdgeBrowser:-1!==navigator.userAgent.indexOf(" Vivaldi/")?this.browserCache=n.VivaldiBrowser:-1!==navigator.userAgent.indexOf(" Safari/")&&-1===navigator.userAgent.indexOf("Chrome")?this.browserCache=n.SafariBrowser:window.chrome&&-1!==navigator.userAgent.indexOf(" Chrome/")?this.browserCache=n.ChromeBrowser:-1!==navigator.userAgent.indexOf(" Trident/")?this.browserCache=n.IEBrowser:this.browserCache=n.UnknownBrowser,this.browserCache)}},{key:"getDeviceString",value:function(){return n[this.getDevice()].toLowerCase().replace("browser","")}},{key:"isFirefox",value:function(){return this.getDevice()===n.FirefoxBrowser}},{key:"isChrome",value:function(){return this.getDevice()===n.ChromeBrowser}},{key:"isEdge",value:function(){return!1}},{key:"isOpera",value:function(){return this.getDevice()===n.OperaBrowser}},{key:"isVivaldi",value:function(){return this.getDevice()===n.VivaldiBrowser}},{key:"isSafari",value:function(){return this.getDevice()===n.SafariBrowser}},{key:"isIE",value:function(){return this.getDevice()===n.IEBrowser}},{key:"isMacAppStore",value:function(){return!1}},{key:"isDev",value:function(){var e="production";return e&&e.match(/\bdevelopment\b/)}},{key:"isSelfHost",value:function(){return!0}}]),e}(),v=r(1);!function(e){e[e.AesCbc256_B64=0]="AesCbc256_B64",e[e.AesCbc128_HmacSha256_B64=1]="AesCbc128_HmacSha256_B64",e[e.AesCbc256_HmacSha256_B64=2]="AesCbc256_HmacSha256_B64",e[e.Rsa2048_OaepSha256_B64=3]="Rsa2048_OaepSha256_B64",e[e.Rsa2048_OaepSha1_B64=4]="Rsa2048_OaepSha1_B64",e[e.Rsa2048_OaepSha256_HmacSha256_B64=5]="Rsa2048_OaepSha256_HmacSha256_B64",e[e.Rsa2048_OaepSha1_HmacSha256_B64=6]="Rsa2048_OaepSha1_HmacSha256_B64"}(f||(f={})),function(e){e[e.PBKDF2_SHA256=0]="PBKDF2_SHA256"}(p||(p={}));var d="undefined"==typeof window?r(1):null,m=function(){function e(){c()(this,e)}return h()(e,null,[{key:"init",value:function(){e.inited||(e.inited=!0,e.isNode="undefined"!=typeof process&&null!=process.release&&"node"===process.release.name,e.isBrowser="undefined"!=typeof window,e.isNativeScript=!e.isNode&&!e.isBrowser,e.isMobileBrowser=e.isBrowser&&this.isMobile(window),e.global=e.isNativeScript?global:e.isNode&&!e.isBrowser?global:window)}},{key:"fromB64ToArray",value:function(t){if(e.isNode||e.isNativeScript)return new Uint8Array(Buffer.from(t,"base64"));for(var r=window.atob(t),n=new Uint8Array(r.length),a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return n}},{key:"fromHexToArray",value:function(t){if(e.isNode||e.isNativeScript)return new Uint8Array(Buffer.from(t,"hex"));for(var r=new Uint8Array(t.length/2),n=0;n<t.length;n+=2)r[n/2]=parseInt(t.substr(n,2),16);return r}},{key:"fromUtf8ToArray",value:function(t){if(e.isNode||e.isNativeScript)return new Uint8Array(Buffer.from(t,"utf8"));for(var r=unescape(encodeURIComponent(t)),n=new Uint8Array(r.length),a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return n}},{key:"fromByteStringToArray",value:function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}},{key:"fromBufferToB64",value:function(t){if(e.isNode||e.isNativeScript)return Buffer.from(t).toString("base64");for(var r="",n=new Uint8Array(t),a=0;a<n.byteLength;a++)r+=String.fromCharCode(n[a]);return window.btoa(r)}},{key:"fromBufferToUtf8",value:function(t){if(e.isNode||e.isNativeScript)return Buffer.from(t).toString("utf8");var r=new Uint8Array(t),n=String.fromCharCode.apply(null,r);return decodeURIComponent(escape(n))}},{key:"fromBufferToByteString",value:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromBufferToHex",value:function(t){if(e.isNode||e.isNativeScript)return Buffer.from(t).toString("hex");var r=new Uint8Array(t);return Array.prototype.map.call(r,function(e){return("00"+e.toString(16)).slice(-2)}).join("")}},{key:"fromUrlB64ToUtf8",value:function(t){var r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("Illegal base64url string!")}return e.fromB64ToUtf8(r)}},{key:"fromB64ToUtf8",value:function(t){return e.isNode||e.isNativeScript?Buffer.from(t,"base64").toString("utf8"):decodeURIComponent(escape(window.atob(t)))}},{key:"newGuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},{key:"getHostname",value:function(t){var r=e.getUrl(t);try{return null!=r?r.hostname:null}catch(e){return null}}},{key:"getHost",value:function(t){var r=e.getUrl(t);try{return null!=r?r.host:null}catch(e){return null}}},{key:"getDomain",value:function(t){if(null==t)return null;if(""===(t=t.trim()))return null;var r=t.startsWith("http://")||t.startsWith("https://");if(!r&&t.indexOf("://")<0&&e.tldEndingRegex.test(t)&&(t="http://"+t,r=!0),r)try{var n=e.getUrlObject(t);if("localhost"===n.hostname||e.validIpAddress(n.hostname))return n.hostname;var a=null!=v&&null!=v.getDomain?v.getDomain(n.hostname):null;return null!=a?a:n.hostname}catch(e){}var i=null!=v&&null!=v.getDomain?v.getDomain(t):null;return null!=i?i:null}},{key:"getQueryParams",value:function(t){var r=e.getUrl(t);if(null==r||null==r.search||""===r.search)return null;var n=new Map;return("?"===r.search[0]?r.search.substr(1):r.search).split("&").forEach(function(e){var t=e.split("=");t.length<1||n.set(decodeURIComponent(t[0]).toLowerCase(),null==t[1]?"":decodeURIComponent(t[1]))}),n}},{key:"getSortFunction",value:function(e,t){return function(r,n){return null==r[t]&&null!=n[t]?-1:null!=r[t]&&null==n[t]?1:null==r[t]&&null==n[t]?0:e.collator?e.collator.compare(r[t],n[t]):r[t].localeCompare(n[t])}}},{key:"isNullOrWhitespace",value:function(e){return null==e||"string"!=typeof e||""===e.trim()}},{key:"validIpAddress",value:function(e){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)}},{key:"isMobile",value:function(e){var t,r=!1;return t=e.navigator.userAgent||e.navigator.vendor||e.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(r=!0),r||null!=e.navigator.userAgent.match(/iPad/i)}},{key:"getUrl",value:function(t){if(null==t)return null;if(""===(t=t.trim()))return null;var r=t.indexOf("://")>-1;if(!r&&t.indexOf(".")>-1)t="http://"+t;else if(!r)return null;return e.getUrlObject(t)}},{key:"getUrlObject",value:function(e){try{if(null!=d)return d.URL?new d.URL(e):d.parse(e);if("function"==typeof URL)return new URL(e);if(null!=window){var t=window.document.createElement("a");return t.href=e,t}}catch(e){}return null}}]),e}();m.inited=!1,m.isNativeScript=!1,m.isNode=!1,m.isBrowser=!0,m.isMobileBrowser=!1,m.global=null,m.tldEndingRegex=/.*\.(com|net|org|edu|uk|gov|ca|de|jp|fr|au|ru|ch|io|es|us|co|xyz|info|ly|mil)$/,m.init();var b=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function o(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(s,o)}u((n=n.apply(e,t||[])).next())})},g=function(){function e(t,r,n,a){if(c()(this,e),null!=r){var i=t;return this.encryptedString=null!=n?i+"."+n+"|"+r:i+"."+r,null!=a&&(this.encryptedString+="|"+a),this.encryptionType=i,this.data=r,this.iv=n,void(this.mac=a)}if(this.encryptedString=t,this.encryptedString){var s=this.encryptedString.split("."),o=null;if(2===s.length)try{this.encryptionType=parseInt(s[0],null),o=s[1].split("|")}catch(e){return}else o=this.encryptedString.split("|"),this.encryptionType=3===o.length?f.AesCbc128_HmacSha256_B64:f.AesCbc256_B64;switch(this.encryptionType){case f.AesCbc128_HmacSha256_B64:case f.AesCbc256_HmacSha256_B64:if(3!==o.length)return;this.iv=o[0],this.data=o[1],this.mac=o[2];break;case f.AesCbc256_B64:if(2!==o.length)return;this.iv=o[0],this.data=o[1];break;case f.Rsa2048_OaepSha256_B64:case f.Rsa2048_OaepSha1_B64:if(1!==o.length)return;this.data=o[0];break;default:return}}}return h()(e,[{key:"decrypt",value:function(e){return b(this,void 0,void 0,i.a.mark(function t(){var r,n,a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.decryptedValue){t.next=2;break}return t.abrupt("return",this.decryptedValue);case 2:if(!(n=m.global.bitwardenContainerService)){t.next=7;break}r=n.getCryptoService(),t.next=8;break;case 7:throw new Error("global bitwardenContainerService not initialized.");case 8:return t.prev=8,t.next=11,r.getOrgKey(e);case 11:return a=t.sent,t.next=14,r.decryptToUtf8(this,a);case 14:this.decryptedValue=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t.catch(8),this.decryptedValue="[error: cannot decrypt]";case 20:return t.abrupt("return",this.decryptedValue);case 21:case"end":return t.stop()}},t,this,[[8,17]])}))}}]),e}(),w=function e(){c()(this,e)},x=function e(t,r){if(c()(this,e),null==t)throw new Error("Must provide key");if(null==r)if(32===t.byteLength)r=f.AesCbc256_B64;else{if(64!==t.byteLength)throw new Error("Unable to determine encType.");r=f.AesCbc256_HmacSha256_B64}if(this.key=t,this.encType=r,r===f.AesCbc256_B64&&32===t.byteLength)this.encKey=t,this.macKey=null;else if(r===f.AesCbc128_HmacSha256_B64&&32===t.byteLength)this.encKey=t.slice(0,16),this.macKey=t.slice(16,32);else{if(r!==f.AesCbc256_HmacSha256_B64||64!==t.byteLength)throw new Error("Unsupported encType/key length.");this.encKey=t.slice(0,32),this.macKey=t.slice(32,64)}null!=this.key&&(this.keyB64=m.fromBufferToB64(this.key)),null!=this.encKey&&(this.encKeyB64=m.fromBufferToB64(this.encKey)),null!=this.macKey&&(this.macKeyB64=m.fromBufferToB64(this.macKey))},k=function e(){c()(this,e),this.environmentUrlsKey=e.environmentUrlsKey,this.disableGaKey=e.disableGaKey,this.disableAddLoginNotificationKey=e.disableAddLoginNotificationKey,this.disableContextMenuItemKey=e.disableContextMenuItemKey,this.disableFaviconKey=e.disableFaviconKey,this.disableAutoTotpCopyKey=e.disableAutoTotpCopyKey,this.enableAutoFillOnPageLoadKey=e.enableAutoFillOnPageLoadKey,this.lockOptionKey=e.lockOptionKey,this.lastActiveKey=e.lastActiveKey,this.neverDomainsKey=e.neverDomainsKey,this.installedVersionKey=e.installedVersionKey,this.localeKey=e.localeKey,this.themeKey=e.themeKey,this.collapsedGroupingsKey=e.collapsedGroupingsKey,this.autoConfirmFingerprints=e.autoConfirmFingerprints,this.dontShowCardsCurrentTab=e.dontShowCardsCurrentTab,this.dontShowIdentitiesCurrentTab=e.dontShowIdentitiesCurrentTab,this.defaultUriMatch=e.defaultUriMatch,this.pinProtectedKey=e.pinProtectedKey,this.protectedPin=e.protectedPin,this.clearClipboardKey=e.clearClipboardKey,this.eventCollectionKey=e.eventCollectionKey};function K(e){return function(t,r,n){var a=n.value,i=new Map,s=function(e){var t=i.get(e);return null!=t?t:(t=new Map,i.set(e,t),t)};return{value:function(){for(var t=this,r=s(this),n=arguments.length,o=new Array(n),u=0;u<n;u++)o[u]=arguments[u];var c=e(o),l=r.get(c);if(null!=l)return l;var h=function(){r.delete(c),0===r.size&&i.delete(t)};return l=a.apply(this,o).then(function(e){return h(),e}).catch(function(e){throw h(),e}),r.set(c,l),l}}}}k.environmentUrlsKey="environmentUrls",k.disableGaKey="disableGa",k.disableAddLoginNotificationKey="disableAddLoginNotification",k.disableChangedPasswordNotificationKey="disableChangedPasswordNotification",k.disableContextMenuItemKey="disableContextMenuItem",k.disableFaviconKey="disableFavicon",k.disableAutoTotpCopyKey="disableAutoTotpCopy",k.enableAutoFillOnPageLoadKey="enableAutoFillOnPageLoad",k.lockOptionKey="lockOption",k.lastActiveKey="lastActive",k.neverDomainsKey="neverDomains",k.installedVersionKey="installedVersion",k.localeKey="locale",k.themeKey="theme",k.collapsedGroupingsKey="collapsedGroupings",k.autoConfirmFingerprints="autoConfirmFingerprints",k.dontShowCardsCurrentTab="dontShowCardsCurrentTab",k.dontShowIdentitiesCurrentTab="dontShowIdentitiesCurrentTab",k.defaultUriMatch="defaultUriMatch",k.pinProtectedKey="pinProtectedKey",k.protectedPin="protectedPin",k.clearClipboardKey="clearClipboardKey",k.eventCollectionKey="eventCollection";var S=function(e,t,r,n){var a,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(s=(i<3?a(s):i>3?a(t,r,s):a(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},B=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},A=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function o(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(s,o)}u((n=n.apply(e,t||[])).next())})},E="key",C="encOrgKeys",_="encPrivateKey",O="encKey",P="keyHash",T=function(){function e(t,r,n){c()(this,e),this.storageService=t,this.secureStorageService=r,this.cryptoFunctionService=n}return h()(e,[{key:"setKey",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.key=e,t.next=3,this.storageService.get(k.lockOptionKey);case 3:if(null==t.sent){t.next=6;break}return t.abrupt("return");case 6:return t.abrupt("return",this.secureStorageService.save(E,e.keyB64));case 7:case"end":return t.stop()}},t,this)}))}},{key:"setKeyHash",value:function(e){return this.keyHash=e,this.storageService.save(P,e)}},{key:"setEncKey",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.storageService.save(O,e);case 4:this.encKey=null;case 5:case"end":return t.stop()}},t,this)}))}},{key:"setEncPrivateKey",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.storageService.save(_,e);case 4:this.privateKey=null;case 5:case"end":return t.stop()}},t,this)}))}},{key:"setOrgKeys",value:function(e){var t={};return e.forEach(function(e){t[e.id]=e.key}),this.orgKeys=null,this.storageService.save(C,t)}},{key:"getKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.key){e.next=2;break}return e.abrupt("return",this.key);case 2:return e.next=4,this.secureStorageService.get(E);case 4:return null!=(t=e.sent)&&(this.key=new x(m.fromB64ToArray(t).buffer)),e.abrupt("return",null==t?null:this.key);case 7:case"end":return e.stop()}},e,this)}))}},{key:"getKeyHash",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.keyHash){e.next=2;break}return e.abrupt("return",this.keyHash);case 2:return e.next=4,this.storageService.get(P);case 4:return null!=(t=e.sent)&&(this.keyHash=t),e.abrupt("return",null==t?null:this.keyHash);case 7:case"end":return e.stop()}},e,this)}))}},{key:"getEncKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t,r,n,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.encKey){e.next=2;break}return e.abrupt("return",this.encKey);case 2:return e.next=4,this.storageService.get(O);case 4:if(null!=(t=e.sent)){e.next=7;break}return e.abrupt("return",null);case 7:return e.next=9,this.getKey();case 9:if(null!=(r=e.sent)){e.next=12;break}return e.abrupt("return",null);case 12:if((a=new g(t)).encryptionType!==f.AesCbc256_B64){e.next=19;break}return e.next=16,this.decryptToBytes(a,r);case 16:n=e.sent,e.next=29;break;case 19:if(a.encryptionType!==f.AesCbc256_HmacSha256_B64){e.next=28;break}return e.next=22,this.stretchKey(r);case 22:return s=e.sent,e.next=25,this.decryptToBytes(a,s);case 25:n=e.sent,e.next=29;break;case 28:throw new Error("Unsupported encKey type.");case 29:if(null!=n){e.next=31;break}return e.abrupt("return",null);case 31:return this.encKey=new x(n),e.abrupt("return",this.encKey);case 33:case"end":return e.stop()}},e,this)}))}},{key:"getPublicKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.publicKey){e.next=2;break}return e.abrupt("return",this.publicKey);case 2:return e.next=4,this.getPrivateKey();case 4:if(null!=(t=e.sent)){e.next=7;break}return e.abrupt("return",null);case 7:return e.next=9,this.cryptoFunctionService.rsaExtractPublicKey(t);case 9:return this.publicKey=e.sent,e.abrupt("return",this.publicKey);case 11:case"end":return e.stop()}},e,this)}))}},{key:"getPrivateKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.privateKey){e.next=2;break}return e.abrupt("return",this.privateKey);case 2:return e.next=4,this.storageService.get(_);case 4:if(null!=(t=e.sent)){e.next=7;break}return e.abrupt("return",null);case 7:return e.next=9,this.decryptToBytes(new g(t),null);case 9:return this.privateKey=e.sent,e.abrupt("return",this.privateKey);case 11:case"end":return e.stop()}},e,this)}))}},{key:"getFingerprint",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=t){r.next=4;break}return r.next=3,this.getPublicKey();case 3:t=r.sent;case 4:if(null!==t){r.next=6;break}throw new Error("No public key available.");case 6:return r.next=8,this.cryptoFunctionService.hash(t,"sha256");case 8:return n=r.sent,r.next=11,this.hkdfExpand(n,m.fromUtf8ToArray(e),32);case 11:return a=r.sent,r.abrupt("return",this.hashPhrase(a.buffer));case 13:case"end":return r.stop()}},r,this)}))}},{key:"getOrgKeys",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t,r,n,a,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!=this.orgKeys&&this.orgKeys.size>0)){e.next=2;break}return e.abrupt("return",this.orgKeys);case 2:return e.next=4,this.storageService.get(C);case 4:if(null!=(t=e.sent)){e.next=7;break}return e.abrupt("return",null);case 7:r=new Map,n=!1,e.t0=i.a.keys(t);case 10:if((e.t1=e.t0()).done){e.next=21;break}if(a=e.t1.value,t.hasOwnProperty(a)){e.next=14;break}return e.abrupt("continue",10);case 14:return e.next=16,this.rsaDecrypt(t[a]);case 16:s=e.sent,r.set(a,new x(s)),n=!0,e.next=10;break;case 21:return n&&(this.orgKeys=r),e.abrupt("return",this.orgKeys);case 23:case"end":return e.stop()}},e,this)}))}},{key:"getOrgKey",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,this.getOrgKeys();case 4:if(null!=(r=t.sent)&&r.has(e)){t.next=7;break}return t.abrupt("return",null);case 7:return t.abrupt("return",r.get(e));case 8:case"end":return t.stop()}},t,this)}))}},{key:"hasKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getKey();case 2:return e.t0=e.sent,e.abrupt("return",null!=e.t0);case 4:case"end":return e.stop()}},e,this)}))}},{key:"hasEncKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageService.get(O);case 2:return t=e.sent,e.abrupt("return",null!=t);case 4:case"end":return e.stop()}},e,this)}))}},{key:"clearKey",value:function(){return this.key=this.legacyEtmKey=null,this.secureStorageService.remove(E)}},{key:"clearKeyHash",value:function(){return this.keyHash=null,this.storageService.remove(P)}},{key:"clearEncKey",value:function(e){return this.encKey=null,e?Promise.resolve():this.storageService.remove(O)}},{key:"clearKeyPair",value:function(e){return this.privateKey=null,this.publicKey=null,e?Promise.resolve():this.storageService.remove(_)}},{key:"clearOrgKeys",value:function(e){return this.orgKeys=null,e?Promise.resolve():this.storageService.remove(C)}},{key:"clearPinProtectedKey",value:function(){return this.storageService.remove(k.pinProtectedKey)}},{key:"clearKeys",value:function(){return Promise.all([this.clearKey(),this.clearKeyHash(),this.clearOrgKeys(),this.clearEncKey(),this.clearKeyPair(),this.clearPinProtectedKey()])}},{key:"toggleKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getKey();case 2:return t=e.sent,e.next=5,this.storageService.get(k.lockOptionKey);case 5:if(null==(r=e.sent)&&0!==r){e.next=11;break}return e.next=9,this.clearKey();case 9:return this.key=t,e.abrupt("return");case 11:return e.next=13,this.setKey(t);case 13:case"end":return e.stop()}},e,this)}))}},{key:"makeKey",value:function(e,t,r,n){return A(this,void 0,void 0,i.a.mark(function a(){var s;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(s=null,null!=r&&r!==p.PBKDF2_SHA256){a.next=13;break}if(null!=n){a.next=6;break}n=5e3,a.next=8;break;case 6:if(!(n<5e3)){a.next=8;break}throw new Error("PBKDF2 iteration minimum is 5000.");case 8:return a.next=10,this.cryptoFunctionService.pbkdf2(e,t,"sha256",n);case 10:s=a.sent,a.next=14;break;case 13:throw new Error("Unknown Kdf.");case 14:return a.abrupt("return",new x(s));case 15:case"end":return a.stop()}},a,this)}))}},{key:"makeKeyFromPin",value:function(e,t,r,n){return A(this,void 0,void 0,i.a.mark(function a(){var s,o,u,c;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.storageService.get(k.pinProtectedKey);case 2:if(null!=(s=a.sent)){a.next=5;break}throw new Error("No PIN protected key found.");case 5:return o=new g(s),a.next=8,this.makePinKey(e,t,r,n);case 8:return u=a.sent,a.next=11,this.decryptToBytes(o,u);case 11:return c=a.sent,a.abrupt("return",new x(c));case 13:case"end":return a.stop()}},a,this)}))}},{key:"makeShareKey",value:function(){return A(this,void 0,void 0,i.a.mark(function e(){var t,r,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cryptoFunctionService.randomBytes(64);case 2:return t=e.sent,e.next=5,this.getPublicKey();case 5:return r=e.sent,e.next=8,this.rsaEncrypt(t,r);case 8:return n=e.sent,e.abrupt("return",[n,new x(t)]);case 10:case"end":return e.stop()}},e,this)}))}},{key:"makeKeyPair",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){var r,n,a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.cryptoFunctionService.rsaGenerateKeyPair(2048);case 2:return r=t.sent,n=m.fromBufferToB64(r[0]),t.next=6,this.encrypt(r[1],e);case 6:return a=t.sent,t.abrupt("return",[n,a]);case 8:case"end":return t.stop()}},t,this)}))}},{key:"makePinKey",value:function(e,t,r,n){return A(this,void 0,void 0,i.a.mark(function a(){var s;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.makeKey(e,t,r,n);case 2:return s=a.sent,a.next=5,this.stretchKey(s);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}},a,this)}))}},{key:"hashPassword",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=t){r.next=4;break}return r.next=3,this.getKey();case 3:t=r.sent;case 4:if(null!=e&&null!=t){r.next=6;break}throw new Error("Invalid parameters.");case 6:return r.next=8,this.cryptoFunctionService.pbkdf2(t.key,e,"sha256",1);case 8:return n=r.sent,r.abrupt("return",m.fromBufferToB64(n));case 10:case"end":return r.stop()}},r,this)}))}},{key:"makeEncKey",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){var r,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getKeyForEncryption(e);case 2:return r=t.sent,t.next=5,this.cryptoFunctionService.randomBytes(64);case 5:return n=t.sent,t.abrupt("return",this.buildEncKey(r,n));case 7:case"end":return t.stop()}},t,this)}))}},{key:"remakeEncKey",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getEncKey();case 2:return r=t.sent,t.abrupt("return",this.buildEncKey(e,r.key));case 4:case"end":return t.stop()}},t,this)}))}},{key:"encrypt",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a,s,o,u;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=e){r.next=2;break}return r.abrupt("return",Promise.resolve(null));case 2:return n="string"==typeof e?m.fromUtf8ToArray(e).buffer:e,r.next=5,this.aesEncrypt(n,t);case 5:return a=r.sent,s=m.fromBufferToB64(a.iv),o=m.fromBufferToB64(a.data),u=null!=a.mac?m.fromBufferToB64(a.mac):null,r.abrupt("return",new g(a.key.encType,o,s,u));case 10:case"end":return r.stop()}},r,this)}))}},{key:"encryptToBytes",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a,s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.aesEncrypt(e,t);case 2:return n=r.sent,a=0,null!=n.mac&&(a=n.mac.byteLength),(s=new Uint8Array(1+n.iv.byteLength+a+n.data.byteLength)).set([n.key.encType]),s.set(new Uint8Array(n.iv),1),null!=n.mac&&s.set(new Uint8Array(n.mac),1+n.iv.byteLength),s.set(new Uint8Array(n.data),1+n.iv.byteLength+a),r.abrupt("return",s.buffer);case 11:case"end":return r.stop()}},r,this)}))}},{key:"rsaEncrypt",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=t){r.next=4;break}return r.next=3,this.getPublicKey();case 3:t=r.sent;case 4:if(null!=t){r.next=6;break}throw new Error("Public key unavailable.");case 6:return r.next=8,this.cryptoFunctionService.rsaEncrypt(e,t,"sha1");case 8:return n=r.sent,r.abrupt("return",new g(f.Rsa2048_OaepSha1_B64,m.fromBufferToB64(n)));case 10:case"end":return r.stop()}},r,this)}))}},{key:"decryptToBytes",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a,s,o;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=m.fromB64ToArray(e.iv).buffer,a=m.fromB64ToArray(e.data).buffer,s=e.mac?m.fromB64ToArray(e.mac).buffer:null,r.next=5,this.aesDecryptToBytes(e.encryptionType,a,n,s,t);case 5:if(null!=(o=r.sent)){r.next=8;break}return r.abrupt("return",null);case 8:return r.abrupt("return",o);case 9:case"end":return r.stop()}},r,this)}))}},{key:"decryptToUtf8",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.aesDecryptToUtf8(e.encryptionType,e.data,e.iv,e.mac,t);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r,this)}))}},{key:"decryptFromBytes",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a,s,o,u;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=e){r.next=2;break}throw new Error("no encBuf.");case 2:n=new Uint8Array(e),a=n[0],s=null,o=null,u=null,r.t0=a,r.next=r.t0===f.AesCbc128_HmacSha256_B64?10:r.t0===f.AesCbc256_HmacSha256_B64?10:r.t0===f.AesCbc256_B64?16:21;break;case 10:if(!(n.length<=49)){r.next=12;break}return r.abrupt("return",null);case 12:return o=n.slice(1,17),u=n.slice(17,49),s=n.slice(49),r.abrupt("break",22);case 16:if(!(n.length<=17)){r.next=18;break}return r.abrupt("return",null);case 18:return o=n.slice(1,17),s=n.slice(17),r.abrupt("break",22);case 21:return r.abrupt("return",null);case 22:return r.next=24,this.aesDecryptToBytes(a,s.buffer,o.buffer,null!=u?u.buffer:null,t);case 24:return r.abrupt("return",r.sent);case 25:case"end":return r.stop()}},r,this)}))}},{key:"randomNumber",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a,s,o,u,c,l,h;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n=0,a=t-e+1,!((s=Math.ceil(Math.log2(a)))>53)){r.next=5;break}throw new Error("We cannot generate numbers larger than 53 bits.");case 5:return o=Math.ceil(s/8),u=Math.pow(2,s)-1,r.t0=Uint8Array,r.next=10,this.cryptoFunctionService.randomBytes(o);case 10:for(r.t1=r.sent,c=new r.t0(r.t1),l=8*(o-1),h=0;h<o;h++)n+=c[h]*Math.pow(2,l),l-=8;if(!((n&=u)>=a)){r.next=17;break}return r.abrupt("return",this.randomNumber(e,t));case 17:return r.abrupt("return",e+n);case 18:case"end":return r.stop()}},r,this)}))}},{key:"aesEncrypt",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=new w,r.next=3,this.getKeyForEncryption(t);case 3:return n.key=r.sent,r.next=6,this.cryptoFunctionService.randomBytes(16);case 6:return n.iv=r.sent,r.next=9,this.cryptoFunctionService.aesEncrypt(e,n.iv,n.key.encKey);case 9:if(n.data=r.sent,null==n.key.macKey){r.next=17;break}return(a=new Uint8Array(n.iv.byteLength+n.data.byteLength)).set(new Uint8Array(n.iv),0),a.set(new Uint8Array(n.data),n.iv.byteLength),r.next=16,this.cryptoFunctionService.hmac(a.buffer,n.key.macKey,"sha256");case 16:n.mac=r.sent;case 17:return r.abrupt("return",n);case 18:case"end":return r.stop()}},r,this)}))}},{key:"aesDecryptToUtf8",value:function(e,t,r,n,a){return A(this,void 0,void 0,i.a.mark(function s(){var o,u,c,l;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.getKeyForEncryption(a);case 2:if(o=i.sent,null==(u=this.resolveLegacyKey(e,o)).macKey||null!=n){i.next=7;break}return console.error("mac required."),i.abrupt("return",null);case 7:if(u.encType===e){i.next=10;break}return console.error("encType unavailable."),i.abrupt("return",null);case 10:if(null==(c=this.cryptoFunctionService.aesDecryptFastParameters(t,r,n,u)).macKey||null==c.mac){i.next=21;break}return i.next=14,this.cryptoFunctionService.hmacFast(c.macData,c.macKey,"sha256");case 14:return l=i.sent,i.next=17,this.cryptoFunctionService.compareFast(c.mac,l);case 17:if(i.sent){i.next=21;break}return console.error("mac failed."),i.abrupt("return",null);case 21:return i.abrupt("return",this.cryptoFunctionService.aesDecryptFast(c));case 22:case"end":return i.stop()}},s,this)}))}},{key:"aesDecryptToBytes",value:function(e,t,r,n,a){return A(this,void 0,void 0,i.a.mark(function s(){var o,u,c,l;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.getKeyForEncryption(a);case 2:if(o=i.sent,null==(u=this.resolveLegacyKey(e,o)).macKey||null!=n){i.next=6;break}return i.abrupt("return",null);case 6:if(u.encType===e){i.next=8;break}return i.abrupt("return",null);case 8:if(null==u.macKey||null==n){i.next=23;break}return(c=new Uint8Array(r.byteLength+t.byteLength)).set(new Uint8Array(r),0),c.set(new Uint8Array(t),r.byteLength),i.next=14,this.cryptoFunctionService.hmac(c.buffer,u.macKey,"sha256");case 14:if(null!==(l=i.sent)){i.next=17;break}return i.abrupt("return",null);case 17:return i.next=19,this.cryptoFunctionService.compare(n,l);case 19:if(i.sent){i.next=23;break}return console.error("mac failed."),i.abrupt("return",null);case 23:return i.next=25,this.cryptoFunctionService.aesDecrypt(t,r,u.encKey);case 25:return i.abrupt("return",i.sent);case 26:case"end":return i.stop()}},s,this)}))}},{key:"rsaDecrypt",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){var r,n,a,s,o,u;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.split("."),n=null,1===r.length)n=f.Rsa2048_OaepSha256_B64,a=[r[0]];else if(2===r.length)try{n=parseInt(r[0],null),a=r[1].split("|")}catch(e){}t.t0=n,t.next=t.t0===f.Rsa2048_OaepSha256_B64?6:t.t0===f.Rsa2048_OaepSha1_B64?6:t.t0===f.Rsa2048_OaepSha256_HmacSha256_B64?6:t.t0===f.Rsa2048_OaepSha1_HmacSha256_B64?6:7;break;case 6:return t.abrupt("break",8);case 7:throw new Error("encType unavailable.");case 8:if(!(null==a||a.length<=0)){t.next=10;break}throw new Error("encPieces unavailable.");case 10:return s=m.fromB64ToArray(a[0]).buffer,t.next=13,this.getPrivateKey();case 13:if(null!=(o=t.sent)){t.next=16;break}throw new Error("No private key.");case 16:u="sha1",t.t1=n,t.next=t.t1===f.Rsa2048_OaepSha256_B64?20:t.t1===f.Rsa2048_OaepSha256_HmacSha256_B64?20:t.t1===f.Rsa2048_OaepSha1_B64?22:t.t1===f.Rsa2048_OaepSha1_HmacSha256_B64?22:23;break;case 20:return u="sha256",t.abrupt("break",24);case 22:return t.abrupt("break",24);case 23:throw new Error("encType unavailable.");case 24:return t.abrupt("return",this.cryptoFunctionService.rsaDecrypt(s,o,u));case 25:case"end":return t.stop()}},t,this)}))}},{key:"getKeyForEncryption",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,this.getEncKey();case 4:if(null==(r=t.sent)){t.next=7;break}return t.abrupt("return",r);case 7:return t.next=9,this.getKey();case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}},t,this)}))}},{key:"resolveLegacyKey",value:function(e,t){return e===f.AesCbc128_HmacSha256_B64&&t.encType===f.AesCbc256_B64?(null==this.legacyEtmKey&&(this.legacyEtmKey=new x(t.key,f.AesCbc128_HmacSha256_B64)),this.legacyEtmKey):t}},{key:"stretchKey",value:function(e){return A(this,void 0,void 0,i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Uint8Array(64),t.t0=r,t.next=4,this.hkdfExpand(e.key,m.fromUtf8ToArray("enc"),32);case 4:return t.t1=t.sent,t.t0.set.call(t.t0,t.t1),t.t2=r,t.next=9,this.hkdfExpand(e.key,m.fromUtf8ToArray("mac"),32);case 9:return t.t3=t.sent,t.t2.set.call(t.t2,t.t3,32),t.abrupt("return",new x(r.buffer));case 12:case"end":return t.stop()}},t,this)}))}},{key:"hkdfExpand",value:function(e,t,r){return A(this,void 0,void 0,i.a.mark(function n(){var a,s,o,u,c,l;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a=32,s=new Uint8Array(r),o=new Uint8Array(0),u=Math.ceil(r/a),c=0;case 5:if(!(c<u)){n.next=19;break}return(l=new Uint8Array(o.length+t.length+1)).set(o),l.set(t,o.length),l.set([c+1],l.length-1),n.t0=Uint8Array,n.next=13,this.cryptoFunctionService.hmac(l.buffer,e,"sha256");case 13:n.t1=n.sent,o=new n.t0(n.t1),s.set(o,c*a);case 16:c++,n.next=5;break;case 19:return n.abrupt("return",s);case 20:case"end":return n.stop()}},n,this)}))}},{key:"hashPhrase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;return A(this,void 0,void 0,i.a.mark(function r(){var n,a,s,o,u,c,l;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n=Math.log(v.EEFLongWordList.length)/Math.log(2),a=Math.ceil(t/n),s=Array.from(new Uint8Array(e)),o=4*s.length,!(a*n>o)){r.next=6;break}throw new Error("Output entropy of hash function is too small");case 6:for(u=[],c=v.fromArray(s,256);a--;)l=c.mod(v.EEFLongWordList.length),c=c.divide(v.EEFLongWordList.length),u.push(v.EEFLongWordList[l]);return r.abrupt("return",u);case 10:case"end":return r.stop()}},r)}))}},{key:"buildEncKey",value:function(e,t){return A(this,void 0,void 0,i.a.mark(function r(){var n,a;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n=null,32!==e.key.byteLength){r.next=10;break}return r.next=4,this.stretchKey(e);case 4:return a=r.sent,r.next=7,this.encrypt(t,a);case 7:n=r.sent,r.next=17;break;case 10:if(64!==e.key.byteLength){r.next=16;break}return r.next=13,this.encrypt(t,e);case 13:n=r.sent,r.next=17;break;case 16:throw new Error("Invalid key size.");case 17:return r.abrupt("return",[new x(t),n]);case 18:case"end":return r.stop()}},r,this)}))}}]),e}();S([K(function(){return"getEncKey"}),B("design:type",Function),B("design:paramtypes",[]),B("design:returntype",Promise)],T.prototype,"getEncKey",null),S([K(function(){return"getOrgKeys"}),B("design:type",Function),B("design:paramtypes",[]),B("design:returntype",Promise)],T.prototype,"getOrgKeys",null);var U=function e(){c()(this,e)},L=function(e,t,r,n){return new(r||(r=Promise))(function(a,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function o(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(s,o)}u((n=n.apply(e,t||[])).next())})},F=function(){function e(t,r){c()(this,e),this.win=t,this.platformUtilsService=r,this.crypto=void 0!==t.crypto?t.crypto:null,this.subtle=this.crypto&&void 0!==t.crypto.subtle?t.crypto.subtle:null,this.isEdge=r.isEdge(),this.isIE=r.isIE();var n=t.navigator.userAgent;this.isOldSafari=r.isSafari()&&(n.indexOf(" Version/10.")>-1||n.indexOf(" Version/9.")>-1)}return h()(e,[{key:"pbkdf2",value:function(e,t,r,n){return L(this,void 0,void 0,i.a.mark(function a(){var s,o,u,c,l,h,f,p,y;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!(this.isEdge||this.isIE||this.isOldSafari)){a.next=6;break}return s="sha256"===r?32:64,o=this.toByteString(e),u=this.toByteString(t),c=v.pbkdf2(o,u,n,s,r),a.abrupt("return",m.fromByteStringToArray(c).buffer);case 6:return l="sha256"===r?256:512,h=this.toBuf(e),f=this.toBuf(t),p={name:"PBKDF2",salt:f,iterations:n,hash:{name:this.toWebCryptoAlgorithm(r)}},a.next=12,this.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveBits"]);case 12:return y=a.sent,a.next=15,this.subtle.deriveBits(p,y,l);case 15:return a.abrupt("return",a.sent);case 16:case"end":return a.stop()}},a,this)}))}},{key:"hash",value:function(e,t){return L(this,void 0,void 0,i.a.mark(function r(){var n,a,s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if((!this.isEdge&&!this.isIE||"sha1"!==t)&&"md5"!==t){r.next=5;break}return n="md5"===t?v.md.md5.create():v.md.sha1.create(),a=this.toByteString(e),n.update(a,"raw"),r.abrupt("return",m.fromByteStringToArray(n.digest().data).buffer);case 5:return s=this.toBuf(e),r.next=8,this.subtle.digest({name:this.toWebCryptoAlgorithm(t)},s);case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}},r,this)}))}},{key:"hmac",value:function(e,t,r){return L(this,void 0,void 0,i.a.mark(function n(){var a,s,o,u,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.isIE||"sha512"!==r){n.next=7;break}return a=v.hmac.create(),s=this.toByteString(t),o=this.toByteString(e),a.start(r,s),a.update(o,"raw"),n.abrupt("return",m.fromByteStringToArray(a.digest().data).buffer);case 7:return u={name:"HMAC",hash:{name:this.toWebCryptoAlgorithm(r)}},n.next=10,this.subtle.importKey("raw",t,u,!1,["sign"]);case 10:return c=n.sent,n.next=13,this.subtle.sign(u,c,e);case 13:return n.abrupt("return",n.sent);case 14:case"end":return n.stop()}},n,this)}))}},{key:"compare",value:function(e,t){return L(this,void 0,void 0,i.a.mark(function r(){var n,a,s,o,u,c,l,h;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.randomBytes(32);case 2:return n=r.sent,a={name:"HMAC",hash:{name:"SHA-256"}},r.next=6,this.subtle.importKey("raw",n,a,!1,["sign"]);case 6:return s=r.sent,r.next=9,this.subtle.sign(a,s,e);case 9:return o=r.sent,r.next=12,this.subtle.sign(a,s,t);case 12:if(u=r.sent,o.byteLength===u.byteLength){r.next=15;break}return r.abrupt("return",!1);case 15:c=new Uint8Array(o),l=new Uint8Array(u),h=0;case 18:if(!(h<l.length)){r.next=24;break}if(c[h]===l[h]){r.next=21;break}return r.abrupt("return",!1);case 21:h++,r.next=18;break;case 24:return r.abrupt("return",!0);case 25:case"end":return r.stop()}},r,this)}))}},{key:"hmacFast",value:function(e,t,r){var n=v.hmac.create();n.start(r,t),n.update(e);var a=n.digest().getBytes();return Promise.resolve(a)}},{key:"compareFast",value:function(e,t){return L(this,void 0,void 0,i.a.mark(function r(){var n,a,s,o,u,c,l,h,f;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.randomBytes(32);case 2:for(n=r.sent,a=new Uint32Array(n),s=v.util.createBuffer(),o=0;o<a.length;o++)s.putInt32(a[o]);return u=s.getBytes(),(c=v.hmac.create()).start("sha256",u),c.update(e),l=c.digest().getBytes(),c.start(null,null),c.update(t),h=c.digest().getBytes(),f=l===h,r.abrupt("return",f);case 16:case"end":return r.stop()}},r,this)}))}},{key:"aesEncrypt",value:function(e,t,r){return L(this,void 0,void 0,i.a.mark(function n(){var a;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["encrypt"]);case 2:return a=n.sent,n.next=5,this.subtle.encrypt({name:"AES-CBC",iv:t},a,e);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"aesDecryptFastParameters",value:function(e,t,r,n){var a=new U;return null!=n.meta&&(a.encKey=n.meta.encKeyByteString,a.macKey=n.meta.macKeyByteString),null==a.encKey&&(a.encKey=v.util.decode64(n.encKeyB64)),a.data=v.util.decode64(e),a.iv=v.util.decode64(t),a.macData=a.iv+a.data,null==a.macKey&&null!=n.macKeyB64&&(a.macKey=v.util.decode64(n.macKeyB64)),null!=r&&(a.mac=v.util.decode64(r)),null==n.meta&&(n.meta={}),null==n.meta.encKeyByteString&&(n.meta.encKeyByteString=a.encKey),null!=a.macKey&&null==n.meta.macKeyByteString&&(n.meta.macKeyByteString=a.macKey),a}},{key:"aesDecryptFast",value:function(e){var t=v.util.createBuffer(e.data),r=v.cipher.createDecipher("AES-CBC",e.encKey);r.start({iv:e.iv}),r.update(t),r.finish();var n=r.output.toString("utf8");return Promise.resolve(n)}},{key:"aesDecrypt",value:function(e,t,r){return L(this,void 0,void 0,i.a.mark(function n(){var a;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["decrypt"]);case 2:return a=n.sent,n.next=5,this.subtle.decrypt({name:"AES-CBC",iv:t},a,e);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"rsaEncrypt",value:function(e,t,r){return L(this,void 0,void 0,i.a.mark(function n(){var a,s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a={name:"RSA-OAEP",hash:{name:this.toWebCryptoAlgorithm(r)}},n.next=3,this.subtle.importKey("spki",t,a,!1,["encrypt"]);case 3:return s=n.sent,n.next=6,this.subtle.encrypt(a,s,e);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}},n,this)}))}},{key:"rsaDecrypt",value:function(e,t,r){return L(this,void 0,void 0,i.a.mark(function n(){var a,s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a={name:"RSA-OAEP",hash:{name:this.toWebCryptoAlgorithm(r)}},n.next=3,this.subtle.importKey("pkcs8",t,a,!1,["decrypt"]);case 3:return s=n.sent,n.next=6,this.subtle.decrypt(a,s,e);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}},n,this)}))}},{key:"rsaExtractPublicKey",value:function(e){return L(this,void 0,void 0,i.a.mark(function t(){var r,n,a,s,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={name:"RSA-OAEP",hash:{name:this.toWebCryptoAlgorithm("sha1")}},t.next=3,this.subtle.importKey("pkcs8",e,r,!0,["decrypt"]);case 3:return n=t.sent,t.next=6,this.subtle.exportKey("jwk",n);case 6:return a=t.sent,s={kty:"RSA",e:a.e,n:a.n,alg:"RSA-OAEP",ext:!0},t.next=10,this.subtle.importKey("jwk",s,r,!0,["encrypt"]);case 10:return o=t.sent,t.next=13,this.subtle.exportKey("spki",o);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}},t,this)}))}},{key:"rsaGenerateKeyPair",value:function(e){return L(this,void 0,void 0,i.a.mark(function t(){var r,n,a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={name:"RSA-OAEP",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:this.toWebCryptoAlgorithm("sha1")}},t.next=3,this.subtle.generateKey(r,!0,["encrypt","decrypt"]);case 3:return n=t.sent,t.next=6,this.subtle.exportKey("spki",n.publicKey);case 6:return a=t.sent,t.next=9,this.subtle.exportKey("pkcs8",n.privateKey);case 9:return s=t.sent,t.abrupt("return",[a,s]);case 11:case"end":return t.stop()}},t,this)}))}},{key:"randomBytes",value:function(e){var t=new Uint8Array(e);return this.crypto.getRandomValues(t),Promise.resolve(t.buffer)}},{key:"toBuf",value:function(e){return"string"==typeof e?m.fromUtf8ToArray(e).buffer:e}},{key:"toByteString",value:function(e){return"string"==typeof e?v.util.encodeUtf8(e):m.fromBufferToByteString(e)}},{key:"toWebCryptoAlgorithm",value:function(e){if("md5"===e)throw new Error("MD5 is not supported in WebCrypto.");return"sha1"===e?"SHA-1":"sha256"===e?"SHA-256":"SHA-512"}}]),e}();function R(e){return e.match("@")?e:"me@"+new URL(this.instance.toLowercase()).hostname}function D(e,t,r,n){return H.apply(this,arguments)}function H(){return(H=o()(i.a.mark(function e(t,r,n,a){var s,o,u,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=R(t),o=N(),e.next=4,o.makeKey(r,s,n,a);case 4:return u=e.sent,e.next=7,o.hashPassword(r,u);case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function N(){var e=new y,t=new F(window,e);return new T(null,null,t)}r.d(t,"getEmail",function(){return R}),r.d(t,"getHashedPassword",function(){return D});t.default={getHashedPassword:D,getEmail:R}}]);